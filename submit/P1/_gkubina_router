# Base FRR image
FROM frrouting/frr:latest

# Create /etc/frr directory
RUN mkdir -p /etc/frr

# Set proper permissions
RUN chown -R frr:frr /etc/frr

# Create daemons file
RUN cat > /etc/frr/daemons <<EOF
zebra=yes
bgpd=yes
ospfd=yes
ospf6d=no
ripd=no
ripngd=no
isisd=yes
ldpd=no
pimd=no
nhrpd=no
eigrpd=no
babeld=no
sharpd=no
pbrd=no
staticd=no
bfd=no
vtysh_enable=yes
zebra_options="-A 127.0.0.1 -s 90000000"
bgpd_options="-A 127.0.0.1"
ospfd_options="-A 127.0.0.1"
isisd_options="-A 127.0.0.1"
EOF

# Default vtysh configuration
RUN echo 'service integrated-vtysh-config' > /etc/frr/vtysh.conf

# Default FRR configuration
RUN cat > /etc/frr/frr.conf <<EOF
!
frr defaults traditional
log syslog informational
service integrated-vtysh-config
!
line vty
!
EOF

# Ensure frrinit.sh is executable
RUN chmod +x /usr/lib/frr/frrinit.sh

# Start only the daemons you need, keep container alive
CMD ["/bin/sh", "-c", "/usr/lib/frr/zebra -d -F traditional -A 127.0.0.1 -s 90000000 && \
                        /usr/lib/frr/bgpd -d -F traditional -A 127.0.0.1 && \
                        /usr/lib/frr/ospfd -d -F traditional -A 127.0.0.1 && \
                        /usr/lib/frr/isisd -d -F traditional -A 127.0.0.1 && \
                        tail -f /dev/null"]
